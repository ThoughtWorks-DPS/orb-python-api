# src/commands/packages.yaml

description: |
  Install python packages. Use 'install-dev: true' to include pipenv development packages.

parameters:

  package-manager:
    description: Currently supports pip and pipenv
    type: enum
    enum: ["pipenv", "pip", "none"]
    default: "none"

  install-dev:
    description: Install dev packages also. Not necessary if installed on executor
    type: boolean
    default: false

  pip-requirements-filename:
    description: name of pip requirements files
    type: string
    default: requirements.txt

  pip-requirements-filename-dev:
    description: name of pip development requirements files
    type: string
    default: requirements-dev.txt

steps:
  - when:
      name: Install python packages
      condition:
        not:
          equal: [ "none", << parameters.package-manager >> ]
      steps:
        - when:
            name: Install requirements from Pipfile
            condition:
              equal: [ "pipenv" , << parameters.package-manager >> ]
            steps:
              - run:
                  name: Generate requirements.txt from Pipfile
                  command: |
                    pipenv install <<#parameters.install-dev>>--dev<</parameters.install-dev>>
        - when:
            name: Install requirements from Pipfile
            condition:
              equal: [ "pip" , << parameters.package-manager >> ]
            steps:
              - run:
                  name: Install packages
                  command: |
                    <<#parameters.install-dev>>pip install -r << parameters.pip-requirements-filename-dev >><</parameters.install-dev>>
                    pip install -r << parameters.pip-requirements-filename >>
                    pip list
